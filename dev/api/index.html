<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · BorrowChecker.jl</title><meta name="title" content="API Reference · BorrowChecker.jl"/><meta property="og:title" content="API Reference · BorrowChecker.jl"/><meta property="twitter:title" content="API Reference · BorrowChecker.jl"/><meta name="description" content="Documentation for BorrowChecker.jl."/><meta property="og:description" content="Documentation for BorrowChecker.jl."/><meta property="twitter:description" content="Documentation for BorrowChecker.jl."/><meta property="og:url" content="https://ai.damtp.cam.ac.uk/borrowcheckerjl/api/"/><meta property="twitter:url" content="https://ai.damtp.cam.ac.uk/borrowcheckerjl/api/"/><link rel="canonical" href="https://ai.damtp.cam.ac.uk/borrowcheckerjl/api/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BorrowChecker.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../auto/"><code>@auto</code></a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Ownership-Macros"><span>Ownership Macros</span></a></li><li><a class="tocitem" href="#References-and-Lifetimes"><span>References and Lifetimes</span></a></li><li><a class="tocitem" href="#Validation"><span>Validation</span></a></li><li><a class="tocitem" href="#IR-Borrow-Checker"><span>IR Borrow Checker</span></a></li><li><a class="tocitem" href="#Types"><span>Types</span></a></li><li><a class="tocitem" href="#Traits"><span>Traits</span></a></li><li><a class="tocitem" href="#Errors"><span>Errors</span></a></li><li><a class="tocitem" href="#Internals"><span>Internals</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mcranmer/BorrowChecker.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/main/docs/src/api.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><h2 id="Ownership-Macros"><a class="docs-heading-anchor" href="#Ownership-Macros">Ownership Macros</a><a id="Ownership-Macros-1"></a><a class="docs-heading-anchor-permalink" href="#Ownership-Macros" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@own"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@own"><code>BorrowChecker.MacrosModule.@own</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@own [:mut] x = value
@own [:mut] x, y, z = (value1, value2, value3)
@own [:mut] for var in iter
    # body
end
@own [:mut] x  # equivalent to @own [:mut] x = x
@own [:mut] (x, y)  # equivalent to @own [:mut] (x, y) = (x, y)</code></pre><p>Create a new owned variable. If <code>:mut</code> is specified, the value will be mutable. Otherwise, the value will be immutable.</p><p>You may also use <code>@own</code> in a <code>for</code> loop to create an owned value for each iteration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L38-L51">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@move"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@move"><code>BorrowChecker.MacrosModule.@move</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@move [:mut] new = old</code></pre><p>Transfer ownership from one variable to another, invalidating the old variable. If <code>:mut</code> is specified, the destination will be mutable. Otherwise, the destination will be immutable. For <code>isbits</code> types, this will automatically use <code>@clone</code> instead.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L142-L149">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@clone"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@clone"><code>BorrowChecker.MacrosModule.@clone</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@clone [:mut] new = old</code></pre><p>Create a deep copy of a value, without moving the source. If <code>:mut</code> is specified, the destination will be mutable. Otherwise, the destination will be immutable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L374-L380">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@take"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@take"><code>BorrowChecker.MacrosModule.@take</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@take var</code></pre><p>Returns the inner value and does a deepcopy. This does <em>not</em> mark the original as moved.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L191-L195">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@take!"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@take!"><code>BorrowChecker.MacrosModule.@take!</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@take! var</code></pre><p>Take ownership of a value, typically used in function arguments. Returns the inner value and marks the original as moved. For <code>isbits</code> types, this will return a copy and not mark the original as moved.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L179-L185">source</a></section></details></article><h2 id="References-and-Lifetimes"><a class="docs-heading-anchor" href="#References-and-Lifetimes">References and Lifetimes</a><a id="References-and-Lifetimes-1"></a><a class="docs-heading-anchor-permalink" href="#References-and-Lifetimes" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@lifetime"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@lifetime"><code>BorrowChecker.MacrosModule.@lifetime</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@lifetime a begin
    @ref ~a rx = x
    # use refs here
end</code></pre><p>Create a lifetime scope for references. References created with this lifetime are only valid within the block and are automatically cleaned up when the block exits.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L206-L214">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@ref"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@ref"><code>BorrowChecker.MacrosModule.@ref</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@ref ~lifetime [:mut] var = value
@ref ~lifetime [:mut] (var1, var2, ...) = (value1, value2, ...)
@ref ~lifetime [:mut] for var in iter
    # body
end</code></pre><p>Create a reference to an owned value within a lifetime scope. See the <code>@lifetime</code> macro for more information on lifetime scopes.</p><p>If <code>:mut</code> is specified, creates a mutable reference. Otherwise, creates an immutable reference. Returns a Borrowed{T} or BorrowedMut{T} that forwards access to the underlying value.</p><div class="admonition is-warning" id="Warning-73e889555889a856"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-73e889555889a856" title="Permalink"></a></header><div class="admonition-body"><p>This will not detect aliasing in the iterator.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L240-L256">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MutexModule.Mutex"><a class="docstring-binding" href="#BorrowChecker.MutexModule.Mutex"><code>BorrowChecker.MutexModule.Mutex</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Mutex{T} &lt;: AbstractMutex{T}</code></pre><p>A mutex that protects a value of type T. Provides safe concurrent access to the protected value.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">m = Mutex([1, 2, 3])
lock(m)
@ref_into :mut arr = m[]
push!(arr, 4)
unlock(m)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/mutex.jl#L16-L30">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@ref_into"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@ref_into"><code>BorrowChecker.MacrosModule.@ref_into</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@ref_into [:mut] var = mutex[]</code></pre><p>Create a reference to the protected value in a mutex.</p><p>If <code>:mut</code> is specified, creates a mutable reference. Otherwise, creates an immutable reference.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">m = Mutex([1, 2, 3])
lock(m) do
    @ref_into :mut arr2 = m[]
    push!(arr2, 4)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L331-L348">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@bc"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@bc"><code>BorrowChecker.MacrosModule.@bc</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@bc func(args...; kwargs...)</code></pre><p>Calls <code>func</code> with the given arguments and keyword arguments, automatically creating temporary borrows for arguments that appear to be owned variables.</p><p><strong>Examples</strong></p><p>Say that we wish to safely modify an array by reference. We have two owned variables, <code>ar1</code> and <code>ar2</code>, and we wish to add the first element of <code>ar2</code> to <code>ar1</code>.</p><pre><code class="language-julia hljs">@own :mut ar1 = [1, 2]
@own ar2 = [3, 4]

add_first!(x, y) = (x[1] += y[1]; nothing)</code></pre><p>If we set up a lifetime scope manually, we might write:</p><pre><code class="language-julia hljs">@lifetime lt begin
    @ref ~lt :mut ref1 = ar1
    @ref ~lt ref2 = ar2
    add_first!(ref1, ref2)
end</code></pre><p>However, most of the time you only need to create a lifetime scope for a single function call, so <code>@bc</code> lets us do this automatically:</p><pre><code class="language-julia hljs">@bc add_first!(@mut(ar1), ar2)</code></pre><p>This will evaluate to something that is quite similar to the manual lifetime scope.</p><p><code>@bc</code> also supports non-owned variables, which will simply get passed through as-is.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L407-L447">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@mut"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@mut"><code>BorrowChecker.MacrosModule.@mut</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@mut expr</code></pre><p>Marks a value to be borrowed mutably in a <code>@bc</code> macro call.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L528-L532">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@&amp;"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@&amp;"><code>BorrowChecker.MacrosModule.@&amp;</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@&amp;(T)
@&amp;(:mut, T)</code></pre><p>Type alias macro for borrowed types. <code>@&amp; T</code> expands to <code>Union{T, Borrowed{T}}</code> and <code>@&amp;(:mut, T)</code> expands to <code>Union{T, BorrowedMut{T}}</code> (as well as their <code>LazyAccessor</code> versions).</p><p>This is useful for writing generic signatures that accept either a raw value or a borrowed value.</p><p><strong>Examples</strong></p><p>Here, we define a function that accepts a mutable borrow of a <code>Vector{Int}</code>. We also demonstrate the use of a <a href="#BorrowChecker.MutexModule.Mutex"><code>Mutex</code></a> to protect the vector.</p><pre><code class="language-julia hljs">julia&gt; function foo(x::@&amp;(:mut, Vector{Int}))
           push!(x, 4)
           return nothing
       end
foo (generic function with 1 method)

julia&gt; m = Mutex([1, 2, 3])
Mutex{Vector{Int64}}([1, 2, 3])

julia&gt; lock(m) do
           @ref_into :mut r = m[]
           foo(r)
       end

julia&gt; println(m)
Mutex{Vector{Int64}}([1, 2, 3, 4])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L624-L657">source</a></section></details></article><h2 id="Validation"><a class="docs-heading-anchor" href="#Validation">Validation</a><a id="Validation-1"></a><a class="docs-heading-anchor-permalink" href="#Validation" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@cc"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@cc"><code>BorrowChecker.MacrosModule.@cc</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">@cc closure_expr</code></pre><p>&quot;Closure Check&quot; is a macro that attempts to verify a closure is compatible with the borrow checker.</p><p>Only immutable references (created with <code>@ref</code> and <code>@bc</code>) are allowed to be captured; all other owned and borrowed variables that are captured will trigger an error.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">@own x = 1
@own :mut y = 2

@lifetime lt begin
    @ref ~lt z = x
    @ref ~lt :mut w = y
    
    # These error as the capturing breaks borrowing rules
    bad = @cc () -&gt; x + 1
    bad2 = @cc () -&gt; w + 1
    
    # However, you are allowed to capture immutable references
    good = @cc () -&gt; z + 1
    # This will not error.
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L538-L565">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.MacrosModule.@spawn"><a class="docstring-binding" href="#BorrowChecker.MacrosModule.@spawn"><code>BorrowChecker.MacrosModule.@spawn</code></a> — <span class="docstring-category">Macro</span></summary><section><div><pre><code class="language-julia hljs">BorrowChecker.@spawn [options...] expr</code></pre><p><code>Threads.@spawn</code> but with <a href="#BorrowChecker.MacrosModule.@cc"><code>@cc</code></a> applied to the expression to ensure safe captures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/macros.jl#L603-L608">source</a></section></details></article><h2 id="IR-Borrow-Checker"><a class="docs-heading-anchor" href="#IR-Borrow-Checker">IR Borrow Checker</a><a id="IR-Borrow-Checker-1"></a><a class="docs-heading-anchor-permalink" href="#IR-Borrow-Checker" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.Auto.@auto"><a class="docstring-binding" href="#BorrowChecker.Auto.@auto"><code>BorrowChecker.Auto.@auto</code></a> — <span class="docstring-category">Macro</span></summary><section><div><p>Automatically borrow-check a function (best-effort).</p><p><code>BorrowChecker.@auto</code> is a <em>drop-in tripwire</em> for existing code:</p><ul><li><strong>Aliasing violations</strong>: mutating a value while another live binding may observe that mutation.</li><li><strong>Escapes / “moves”</strong>: storing a mutable value somewhere that outlives the current scope (e.g. a global cache / a field / a container), then continuing to reference it locally.</li></ul><p>On function entry, it checks the current specialization and caches the result so future calls are fast. On failure it throws <code>BorrowCheckError</code> with best-effort source context.</p><p><strong>Options</strong></p><p>Options are parsed by the macro and compiled into a <code>BorrowChecker.Auto.Config</code> (and are part of the checked-cache key).</p><ul><li><code>scope</code> (default: <code>:function</code>): controls whether the checker recursively borrow-checks callees (call-graph traversal).<ul><li><code>:none</code>: disable <code>@auto</code> entirely (no IR borrow-checking; returns the original definition).</li><li><code>:function</code>: check only the annotated method.</li><li><code>:module</code>: recursively check callees whose defining module matches the module where <code>@auto</code> is used.</li><li><code>:user</code>: recursively check callees, but ignore <code>Core</code> and <code>Base</code> (including their submodules).</li><li><code>:all</code>: recursively check callees across all modules (very aggressive).</li></ul></li><li><code>max_summary_depth</code> (default: <code>12</code>): limits recursive effect summarization depth used when the checker cannot directly resolve effects.</li></ul><p>Examples:</p><pre><code class="language-julia hljs">BorrowChecker.@auto scope=:module function f(x)
    g(x)
end

BorrowChecker.@auto max_summary_depth=4 optimize_until=&quot;compact 1&quot; function h(x)
    g(x)
end</code></pre><p><strong>Extended help</strong></p><p><strong><code>optimize_until</code></strong></p><p><code>optimize_until</code> (default: <code>BorrowChecker.Auto.DEFAULT_CONFIG.optimize_until</code>) controls which compiler pass to stop at when fetching IR via <code>Base.code_ircode_by_type</code>.</p><p>Pass names vary across Julia versions; <code>@auto</code> tries to normalize common spellings like <code>&quot;compact 1&quot;</code> / <code>&quot;compact_1&quot;</code> when possible.</p><div class="admonition is-warning" id="Warning-c1b90443e35abcdd"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-c1b90443e35abcdd" title="Permalink"></a></header><div class="admonition-body"><p>This macro is highly experimental and compiler-dependent. There are likely bugs and false positives. It is intended for development and testing, and does not guarantee memory safety.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/auto/frontend.jl#L518-L571">source</a></section></details></article><h2 id="Types"><a class="docs-heading-anchor" href="#Types">Types</a><a id="Types-1"></a><a class="docs-heading-anchor-permalink" href="#Types" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.AbstractOwned"><a class="docstring-binding" href="#BorrowChecker.TypesModule.AbstractOwned"><code>BorrowChecker.TypesModule.AbstractOwned</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">AbstractOwned{T}</code></pre><p>Base type for all owned value types.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L27-L31">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.AbstractBorrowed"><a class="docstring-binding" href="#BorrowChecker.TypesModule.AbstractBorrowed"><code>BorrowChecker.TypesModule.AbstractBorrowed</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">AbstractBorrowed{T}</code></pre><p>Base type for all borrowed reference types.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L34-L38">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.Owned"><a class="docstring-binding" href="#BorrowChecker.TypesModule.Owned"><code>BorrowChecker.TypesModule.Owned</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Owned{T} &lt;: AbstractOwned{T}</code></pre><p>An immutable owned value. Common operations:</p><ul><li>Create using <code>@own x = value</code></li><li>Access value using <code>@take!</code> (moves) or <code>@take</code> (copies)</li><li>Borrow using <code>@ref</code></li><li>Access fields/indices via <code>.field</code> or <code>[indices...]</code> (returns LazyAccessor)</li></ul><p>Once moved, the value cannot be accessed again.</p><p><strong>Internal fields (not part of public API):</strong></p><ul><li><code>value::T</code>: The contained value</li><li><code>moved::Bool</code>: Whether the value has been moved</li><li><code>immutable_borrows::Int</code>: Count of active immutable borrows</li><li><code>symbol::Symbol</code>: Variable name for error reporting</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L41-L58">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.OwnedMut"><a class="docstring-binding" href="#BorrowChecker.TypesModule.OwnedMut"><code>BorrowChecker.TypesModule.OwnedMut</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">OwnedMut{T} &lt;: AbstractOwned{T}</code></pre><p>A mutable owned value. Common operations:</p><ul><li>Create using <code>@own :mut x = value</code></li><li>Access value using <code>@take!</code> (moves) or <code>@take</code> (copies)</li><li>Modify by setproperty! or setindex!: <code>x.field = value</code> or <code>x[indices...] = value</code></li><li>Borrow using <code>@ref</code> or <code>@ref :mut</code></li><li>Access fields/indices via <code>.field</code> or <code>[indices...]</code> (returns LazyAccessor)</li></ul><p>Once moved, the value cannot be accessed again.</p><p><strong>Internal fields (not part of public API):</strong></p><ul><li><code>value::T</code>: The contained value</li><li><code>moved::Bool</code>: Whether the value has been moved</li><li><code>immutable_borrows::Int</code>: Count of active immutable borrows</li><li><code>mutable_borrows::Int</code>: Count of active mutable borrows</li><li><code>symbol::Symbol</code>: Variable name for error reporting</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L75-L94">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.Borrowed"><a class="docstring-binding" href="#BorrowChecker.TypesModule.Borrowed"><code>BorrowChecker.TypesModule.Borrowed</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Borrowed{T,O&lt;:AbstractOwned} &lt;: AbstractBorrowed{T}</code></pre><p>An immutable reference to an owned value. Common operations:</p><ul><li>Create using <code>@ref lt x = value</code></li><li>Access value using <code>@take</code> (copies)</li><li>Access fields/indices via <code>.field</code> or <code>[indices...]</code> (returns LazyAccessor)</li></ul><p>Multiple immutable references can exist simultaneously. The reference is valid only within its lifetime scope.</p><p><strong>Internal fields (not part of public API):</strong></p><ul><li><code>value::T</code>: The referenced value</li><li><code>owner::O</code>: The original owned value</li><li><code>lifetime::Lifetime</code>: The scope in which this reference is valid</li><li><code>symbol::Symbol</code>: Variable name for error reporting</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L123-L140">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.BorrowedMut"><a class="docstring-binding" href="#BorrowChecker.TypesModule.BorrowedMut"><code>BorrowChecker.TypesModule.BorrowedMut</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">BorrowedMut{T,O&lt;:OwnedMut} &lt;: AbstractBorrowed{T}</code></pre><p>A mutable reference to an owned value. Common operations:</p><ul><li>Create using <code>@ref lt :mut x = value</code></li><li>Access value using <code>@take</code> (copies)</li><li>Access fields/indices via <code>.field</code> or <code>[indices...]</code> (returns LazyAccessor)</li></ul><p>Only one mutable reference can exist at a time, and no immutable references can exist simultaneously.</p><p><strong>Internal fields (not part of public API):</strong></p><ul><li><code>value::T</code>: The referenced value</li><li><code>owner::O</code>: The original owned value</li><li><code>lifetime::Lifetime</code>: The scope in which this reference is valid</li><li><code>symbol::Symbol</code>: Variable name for error reporting</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L179-L196">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.LazyAccessor"><a class="docstring-binding" href="#BorrowChecker.TypesModule.LazyAccessor"><code>BorrowChecker.TypesModule.LazyAccessor</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">LazyAccessor{T,P,S,O&lt;:Union{AbstractOwned,AbstractBorrowed}} &lt;: AbstractWrapper{T}</code></pre><p>A lazy accessor for properties or indices of owned or borrowed values. Maintains ownership semantics while allowing property/index access without copying or moving.</p><p>Created automatically when accessing properties or indices of owned/borrowed values:</p><pre><code class="language-julia hljs">@own x = (a=1, b=2)
x.a  # Returns a LazyAccessor</code></pre><p><strong>Internal fields (not part of public API):</strong></p><ul><li><code>parent::P</code>: The parent value being accessed</li><li><code>property::S</code>: The property/index being accessed</li><li><code>property_type::Type{T}</code>: Type of the accessed property/index</li><li><code>target::O</code>: The original owned/borrowed value</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L247-L266">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.OrBorrowed"><a class="docstring-binding" href="#BorrowChecker.TypesModule.OrBorrowed"><code>BorrowChecker.TypesModule.OrBorrowed</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">OrBorrowed{T}</code></pre><p>Type alias for accepting either a value of type <code>T</code> or a borrowed reference to it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L329-L333">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.TypesModule.OrBorrowedMut"><a class="docstring-binding" href="#BorrowChecker.TypesModule.OrBorrowedMut"><code>BorrowChecker.TypesModule.OrBorrowedMut</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">OrBorrowedMut{T}</code></pre><p>Type alias for accepting either a value of type <code>T</code> or a mutable borrowed reference to it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/types.jl#L336-L340">source</a></section></details></article><h2 id="Traits"><a class="docs-heading-anchor" href="#Traits">Traits</a><a id="Traits-1"></a><a class="docs-heading-anchor-permalink" href="#Traits" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.StaticTraitModule.is_static"><a class="docstring-binding" href="#BorrowChecker.StaticTraitModule.is_static"><code>BorrowChecker.StaticTraitModule.is_static</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">is_static(x)</code></pre><p>This trait is used to determine if we can safely <code>@take!</code> a value without marking the original as moved.</p><p>This is somewhat analogous to the <code>Copy</code> trait in Rust, although because Julia immutables are truly immutable, we actually do not need to copy on these.</p><p>For the most part, this is equal to <code>isbits</code>, but it also includes things like <code>Symbol</code> and <code>Type{T}</code> (recursively), which are not <code>isbits</code>, but which are immutable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/static_trait.jl#L3-L17">source</a></section></details></article><h2 id="Errors"><a class="docs-heading-anchor" href="#Errors">Errors</a><a id="Errors-1"></a><a class="docs-heading-anchor-permalink" href="#Errors" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="BorrowChecker.ErrorsModule.BorrowError"><a class="docstring-binding" href="#BorrowChecker.ErrorsModule.BorrowError"><code>BorrowChecker.ErrorsModule.BorrowError</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">abstract type BorrowError &lt;: Exception end</code></pre><p>Base type for all errors related to borrow checking rules.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/errors.jl#L3-L7">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.ErrorsModule.MovedError"><a class="docstring-binding" href="#BorrowChecker.ErrorsModule.MovedError"><code>BorrowChecker.ErrorsModule.MovedError</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">MovedError &lt;: BorrowError</code></pre><p>Error thrown when attempting to use a value that has been moved.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/errors.jl#L10-L14">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.ErrorsModule.BorrowRuleError"><a class="docstring-binding" href="#BorrowChecker.ErrorsModule.BorrowRuleError"><code>BorrowChecker.ErrorsModule.BorrowRuleError</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">BorrowRuleError &lt;: BorrowError</code></pre><p>Error thrown when attempting to violate borrow checking rules, such as having multiple mutable references.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/errors.jl#L28-L32">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.ErrorsModule.SymbolMismatchError"><a class="docstring-binding" href="#BorrowChecker.ErrorsModule.SymbolMismatchError"><code>BorrowChecker.ErrorsModule.SymbolMismatchError</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">SymbolMismatchError &lt;: BorrowError</code></pre><p>Error thrown when attempting to reassign a variable without using proper ownership transfer mechanisms.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/errors.jl#L37-L41">source</a></section></details></article><article><details class="docstring" open="true"><summary id="BorrowChecker.ErrorsModule.ExpiredError"><a class="docstring-binding" href="#BorrowChecker.ErrorsModule.ExpiredError"><code>BorrowChecker.ErrorsModule.ExpiredError</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">ExpiredError &lt;: BorrowError</code></pre><p>Error thrown when attempting to use a reference whose lifetime has expired.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/MilesCranmer/BorrowChecker.jl/blob/e2466bd3b5321fde603c885bf3af2c39386284a5/src/errors.jl#L19-L23">source</a></section></details></article><h2 id="Internals"><a class="docs-heading-anchor" href="#Internals">Internals</a><a id="Internals-1"></a><a class="docs-heading-anchor-permalink" href="#Internals" title="Permalink"></a></h2><p>Normally, you should rely on <code>OrBorrowed</code> and <code>OrBorrowedMut</code> to work with borrowed values, or use <code>@take</code> and <code>@take!</code> to unwrap owned values. However, for convenience, it might be useful to define functions on <code>Owned</code> and <code>OwnedMut</code> types, if you are confident that your operation will not &quot;move&quot; the input or return a view of it.</p><p>Many functions in Base are already overloaded. But if you need to define your own, you can do so by using the <code>request_value</code> function and the <code>AllWrappers</code> type union.</p><h3 id="Core-Types"><a class="docs-heading-anchor" href="#Core-Types">Core Types</a><a id="Core-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Types" title="Permalink"></a></h3><ul><li><code>AllWrappers{T}</code>: A type union that includes all wrapper types (<code>Owned{T}</code>, <code>OwnedMut{T}</code>, <code>Borrowed{T}</code>, <code>BorrowedMut{T}</code>, and <code>LazyAccessor{T}</code>). This is used to write generic methods that work with any wrapped value.</li></ul><h3 id="Core-Functions"><a class="docs-heading-anchor" href="#Core-Functions">Core Functions</a><a id="Core-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Functions" title="Permalink"></a></h3><ul><li><code>request_value(x, Val(:read))</code>: Request read access to a wrapped value</li><li><code>request_value(x, Val(:write))</code>: Request write access to a wrapped value</li></ul><h3 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h3><p>Here&#39;s how common operations are overloaded:</p><ol><li>Binary operations (like <code>*</code>) that only need read access:</li></ol><pre><code class="language-julia hljs">function Base.:(*)(l::AllWrappers{&lt;:Number}, r::AllWrappers{&lt;:Number})
    return Base.:(*)(request_value(l, Val(:read)), request_value(r, Val(:read)))
end</code></pre><ol><li>Mutating operations (like <code>pop!</code>) that need write access:</li></ol><pre><code class="language-julia hljs">function Base.pop!(r::AllWrappers)
    return Base.pop!(request_value(r, Val(:write)))
end</code></pre><p>The <code>request_value</code> function performs safety checks before allowing access:</p><ul><li>For read access: Verifies the value hasn&#39;t been moved</li><li>For write access: Verifies the value is mutable and not borrowed</li></ul><p>Note that for operations that need write access, and return a view of the input, it is wise to modify the standard output to return <code>nothing</code> instead, which is what we do for <code>push!</code>:</p><pre><code class="language-julia hljs">function Base.push!(r::AllWrappers, items...)
    Base.push!(request_value(r, Val(:write)), items...)
    return nothing
end</code></pre><p>While this violates the expected return type, it is a necessary evil for safety. The <code>nothing</code> return will cause loud errors if you have code that relies on this design. This is good! Loud bugs are collaborators; silent bugs are saboteurs.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../auto/">« <code>@auto</code></a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 19 January 2026 22:54">Monday 19 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
